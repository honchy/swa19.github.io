---
layout: post
title: "coding的坑"
date: 2017-09-07 16:49:48 +0800
categories： 基础
tags: java
---

# RocketMqsubject和tag配置问题导致消息重复发送
在A系统中会发送给B系统一个RocketMq消息，B系统在接收到这个消息之后，发送消息给C系统  
根据日志，ProducerA发送了一条消息，但是到ConsumerB的之后，首先接收到和Producer发送消息一样的msgId的消息，然后不断刷日志，显示ConsumerB持续不断地接收到同样消息内容，但是msgId不同的消息。  
开始因为初次配置使用RocketMq，怀疑RocketMq的处理机制问题，但其他系统应用不存在这个问题；后来在梳理业务逻辑的时候，发现C系统接收的是来自A系统的消息，而这个是不合理的，需要对C系统和B系统接收消息的tag做一个区分，由此才意识到，原来B系统一直在接收消息，然后发送消息，发送的消息由于subject和tag配置的问题，B系统会接收到自己发送的消息并处理，由此，一个死循环导致了消息被不断地重复发送和接收和处理  
遇到问题而不得其解的时候，不要怀疑人生。有句话说：事出反常必有妖

# java引用
对变量做临时赋值后，后续在用的时候没有恢复成原有的值   
由于java中的变量传递的是变量的引用，所以在方法内对一个变量做的改变在这个方法调用结束之后会继续保留，这个错误很弱智，但也很容易被忽略



