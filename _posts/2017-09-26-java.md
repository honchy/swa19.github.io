---
layout: post
title: "内存泄露"
date: 2017-09-26 09:07:03 +0800
tags: java
---

# 问题介绍
最近做项目，遇到了PermSpace不足的问题，并且调整jvm的MaxPermSize到512M之后错误依旧，由于是在别人的工程中写的新代码，怀疑是别人的工程代码的问题。找人看过后，被告知别人的代码没有问题，但在我的机器上却一直报outofmemory错误，没办法只能自己解决了。
首先明确下PermSpace用来存放什么信息，PermSpace也就是方法区，用来存放类相关的信息。在编译时，类加载器从class文件中，提取出类的相关信息，并存储在方法区中。
在实例化一个类的对象时，jvm将会从方法区中获取这个类的相关信息，并完成初始化工作。方法区的内存也是可以进行回收的，当某个类不再被使用时，jvm将卸载这个类，进行垃圾回收  
## 解决方法
当出现PermSpace空间OutOfMemory的错误时，可以通过调整jvm方法区的内存大小来尝试初步解决问题：
和方法区相关的jvm参数有两个，-XX:PermSize和-XX:MaxPermSize
如果使用tomcat启动服务，可以修改Tomcat的配置文件catalina.sh文件，添加配置：`JAVA_OPTS="$JAVA_OPTS -Xms512m -Xmx1024m -XX:PermSize=256M -XX:MaxPermSize=512m"`
## 问题排查
当出现内存溢出，很大概率说明代码还是存在问题的，需要排查是哪部分代码引起的溢出问题
查看永久代的内存分配情况：`jstat -gcpermcapacity <pid> `
>jstat是一个很强大的用来查看jvm参数的工具，它利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控。其他jdk自带的工具还有 jstack, jconsole, jinfo, jmap, jdb，后边可以再详细写一个总结。


# 什么情况容易导致内存溢出


# 内存溢出的排查方法




http://blog.csdn.net/u012152619/article/details/46968883