---
layout: post
title:  "系统升级jdk遇到的问题"
date:   2017-12-20 16:18:23 +0800
categories: 基础
tags: java
---

此次升级jdk6到8的同时,还升级了tomcat,spring,dubbo等版本

1. beanutils.copyProperties报错
当属性值为空时,抛出异常:`No value specified for 'Date'`
这个异常是升级jdk之后报错,并且并不是必现的,也就是有些地方的调用会报错,有些地方则不报错.分析之后发现引入的两个jar包中均存在这个类和方法的定义,也就是存在jar包冲突.而其中一个jar包的类编译的版本为1.3,猜测是jdk版本过低,升级到jdk8之后存在不支持,导致默认的Converter类无法加载而报错.
解决方法是:升级jar包,同时排除存在依赖冲突的jar包.

2. 大量页面404
由于系统中日志太少,刷新页面后,后台无任何日志,无奈只能单步DEBUG跟踪调试.发现在调用到mybatis的方法时,抛出了反射的异常,异常信息为找不到对应方法.检查后发现这个jar包没有被引进来,但在配置文件中强制使用了log4j做日志处理.
后端抛出的Throwable异常并没有被catch住,并且通过dubbo调用,传递到前端服务;
前端方法如下:
~~~
	@RequestMapping(value = "/search")
	public String search(Model model,MyCaseSearchConditionDto conditions,PageInfo pageInfo) {
        return showPage(conditions, pageInfo, model, 1, true);
	}
~~~
这里返回的字符串不再是一个页面路径,而是一个异常信息的字符串.tomcat解析的时候当然找不到对应路径的页面,所以抛出了404错误
将配置中使用的log4j的配置删除后问题解决.
~~~
	<settings>
		<setting name="logImpl" value="LOG4J" />
		<setting name="cacheEnabled" value="false" />
		<setting name="lazyLoadingEnabled" value="false" />
		<setting name="aggressiveLazyLoading" value="false" />
		<setting name="multipleResultSetsEnabled" value="true" />
		<setting name="useColumnLabel" value="true" />
		<setting name="useGeneratedKeys" value="false" />
		<setting name="defaultExecutorType" value="SIMPLE" />
		<setting name="defaultStatementTimeout" value="25000" />
	</settings>
~~~

3. spring升级
spring升级至4.3.13.RELEASE之后,对应的quarter也要做升级
~~~
<dependency>
   <groupId>org.quartz-scheduler</groupId>
   <artifactId>quartz</artifactId>
   <version>2.3.0</version>
</dependency>
~~~
升级之后,对应的API发生了变化,需要修改原来的配置

4. tomcat升级至8
升级后的tomcat启动后会新增一个文件tomcat.pid,当启动的时候新建文件,停止时删除文件,从而避免了以前版本中启动多个tomcat实例的弊端